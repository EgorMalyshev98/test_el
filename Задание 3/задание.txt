Задание 3: Кодирование, Python и SQL оптимизация
У вас есть данные о заказах пользователей. Напишите Python-скрипт, который читает данную таблицу (файл) с данными о заказах. Ваша задача — загрузить их в БД, провести оптимизированную обработку и написать SQL-запросы. Формат: Тестовая таблица

Часть 1: Оптимизированная загрузка в БД
1. Напишите ETL-скрипт, который:
- Читает CSV-файл с заказами (1 млн строк).
- Выполняет нормализацию данных (выносит курсы и предметы в справочные таблицы).
- Использует batch-загрузку (COPY вместо INSERT).
- Работает асинхронно (например, asyncpg для PostgreSQL).
2. Как ускорить загрузку данных?
- Какие параметры БД (work_mem, shared_buffers) можно настроить?
- Как избежать блокировок таблиц при массовой вставке?
Часть 2: Оптимизация SQL-запросов
1. Напишите SQL-запрос, который возвращает ТОП-5 самых продаваемых курсов по месяцам.
2. Напишите SQL-запрос, который возвращает ТОП-3 самых популярных пакетов по предметам.
3. Оптимизируйте запросы:
- Какие индексы добавить?
- Какую стратегию партиционирования выбрать (range, hash)?
- Как минимизировать full table scan?

	Часть 3: Работа с неструктурированными данными

В базе данных имеется неструктурированный список курсов, представленный в разных форматах и названиях. Ваша задача — разработать алгоритм нормализации названий курсов, чтобы они соответствовали единому стандарту.
Описание входных данных:
У вас есть фрагмент таблицы, содержащей сырые данные о курсах и предметах. Ваш алгоритм должен приводить их к категориям представленным в Приложении 1.
Требования к решению:
1. Разработать Python-скрипт, который:
Принимает в качестве входных данных pandas.DataFrame с сырыми названиями курсов и предметов.
Применяет нормализацию названий курсов с помощью словаря соответствий и шаблонов.
Генерирует новые столбецы standardized_course и standardized_subject  с категориями курсов и предметов.
2. Учесть обработку ошибок:
Учитывать случаи, когда название курса или предмета отсутствует.
Обрабатывать лишние пробелы и регистр (lower() и strip()).
Учитывать возможность появления латинских букв.
Обрабатывать неявные наименования курсов (например, "2 месяца полугодового платинум и марафон в подарок" → Спецкурс).
3. Оптимизировать процесс классификации:
Использовать регулярные выражения (regex) для поиска паттернов.
Учитывать возможные изменения названий в будущем.
4. Вывести финальный DataFrame с результатами обработки.
 	Дополнительные требования:
1. Код должен быть хорошо структурирован, с логичными функциями и комментариями.
2. Предоставьте unit-тесты (например, через pytest) для проверки работы алгоритма.
3. Оцените производительность кода, если количество строк > 100 000.






Приложение 1
course_replacements = {
        '2 месяца годового платинум и марафон в подарок': 'Спецкурс',
        '2 месяца годового стандарт и марафон в подарок': 'Спецкурс',
        '2 месяца полугодового платинум и марафон в подарок': 'Спецкурс',
        '2 месяца полугодового стандарт и марафон в подарок': 'Спецкурс',
        'В погоне за пятеркой 2К25 стандарт': 'Весенний курс',
        'В погоне за пятеркой 2к24': 'Весенний курс',
        'В погоне за пятеркой 2к24 (Курс 2.0)': 'Весенний курс',
        'В погоне за пятеркой 2к24 (полный курс 2.0)': 'Весенний курс',
        'В погоне за пятеркой 2к24 (полный курс)': 'Весенний курс',
        'В погоне за соткой 2к20': 'Полугодовой курс',
        'В погоне за соткой 2к22 Winter': 'Полугодовой курс',
        'В погоне за соткой': 'Полугодовой курс',
        'В погоне за соткой 2к24 Winter Минимал': 'Полугодовой курс',
        'В погоне за соткой 2к23 Winter': 'Полугодовой курс',
        'В погоне за соткой 2к23 Winter Лайт': 'Полугодовой курс',
        'В погоне за соткой 2к23 лайт': 'Полугодовой курс',
        'В погоне за соткой 2к23 Winter лайт': 'Полугодовой курс',
        'В погоне за соткой 2к24 Winter Платинум': 'Полугодовой курс',
        'В погоне за соткой 2к24 Winter Стандарт': 'Полугодовой курс',
        'В погоне за соткой 2к24. Начни сейчас!': 'Полугодовой курс',
        'В погоне за соткой 2к24 Начни сейчас!': 'Полугодовой курс',
        'В погоне за соткой 2к24 Winter Стандарт (5 месяцев)': 'Полугодовой курс',
        'В погоне за соткой 2к24 Winter. Начни сейчас!': 'Полугодовой курс',
        'В погоне за соткой 2к24 минимал': 'Годовой курс',
        'В погоне за соткой 2к24 платинум': 'Годовой курс',
        'В погоне за соткой 2к24 стандарт': 'Годовой курс',
        'ВСЕ и СРАЗУ / ОГЭ': 'Спецкурс',
        'Годовой 2К25 платинум с Катей': 'Годовой курс',
        'Годовой 2К25 платинум с Машей': 'Годовой курс',
        'Годовой 2К25 стандарт с Катей': 'Годовой курс',
        'Годовой 2К25 стандарт с Машей': 'Годовой курс',
        'Годовой 2к25 минимал': 'Годовой курс',
        'Годовой 2к25 минимал с Машей': 'Годовой курс',
        'Годовой 2к25 платинум': 'Годовой курс',
        'Годовой 2к25 стандарт': 'Годовой курс',
        'Годовой курс 2к25': 'Годовой курс',
        'Годовой огэ биология 2025': 'Годовой курс',
        'Годовой огэ матан 2025': 'Годовой курс',
        'Годовой огэ общага 2025': 'Годовой курс',
        'Годовой огэ русский 2025': 'Годовой курс',
        'КУРС 3в1 - экономика, политика, право': 'Спецкурс',
        'Курс PRO': 'Спецкурс',
        'Пакет PRO': 'Спецкурс',
        'Пакет PRO "Финальный рывок"': 'Спецкурс',
        'Литра Годовой курс 2024': 'Годовой курс',
        'Марафон 2К24 "Билет на бюджет"': 'Весенний курс',
        'Марафон 2К24 "Марафон+"': 'Весенний курс',
        'Марафон 2К24 "Ну норм"': 'Весенний курс',
        'Марафон 2К24 "Сын маминой подруги"': 'Весенний курс',
        'Общага Годовой курс 2024': 'Годовой курс',
        'Полугодовой ЕГЭ Все сам': 'Полугодовой курс',
        'Полугодовой ЕГЭ Комфортик': 'Полугодовой курс',
        'Полугодовой ЕГЭ На бюджет в ВУЗ мечты': 'Полугодовой курс',
        'Полугодовой курс ЕГЭ Все сам': 'Полугодовой курс',
        'Полугодовой курс ЕГЭ Комфортик': 'Полугодовой курс',
        'Полугодовой курс ЕГЭ На максималках': 'Полугодовой курс',
        'Последняя гонка 2К24': 'Весенний курс',
        'Последняя гонка 2К24 (полный курс)': 'Весенний курс',
        'Последняя гонка 2к24 Минимал': 'Весенний курс',
        'Последняя гонка 2к24 Стандарт': 'Весенний курс',
        'Прокачка Политики': 'Спецкурс',
        'Физика Годовой курс 2024 ': 'Годовой курс',
        'Химия Годовой курс 2024': 'Годовой курс',
        'годовой 2к25 англ': 'Годовой курс',
        'годовой 2к25 база': 'Годовой курс',
        'годовой 2к25 биология': 'Годовой курс',
        'годовой 2к25 история': 'Годовой курс',
        'годовой 2к25 литра': 'Годовой курс',
        'годовой 2к25 общага': 'Годовой курс',
        'годовой 2к25 профиль': 'Годовой курс',
        'годовой 2к25 русский': 'Годовой курс',
        'годовой 2к25 физика': 'Годовой курс',
        'годовой 2к25 химия': 'Годовой курс',
        'Полугодовой курс ОГЭ': 'Полугодовой курс',
        'В погоне за соткой 2к24 Winter платинум': 'Полугодовой курс',
        'Марафон 2к24 "Билет на бюджет"': 'Весенний курс',
        'Марафон 2к24 "Ну норм"': 'Весенний курс',
        'ЕГЭ': 'Спецкурс',
        'ОГЭ': 'Спецкурс',
        'Математика с 0 до 70 баллов ПЛАТИНУМ': 'Спецкурс',
        'Русский': 'Спецкурс',
        'Обществознание': 'Спецкурс',
        'Проф. математика с 0 до 70 баллов': 'Спецкурс',
        'Весна ЕГЭ Имба': 'Весенний курс',
        'Весна ЕГЭ Нормис': 'Весенний курс',
        'Полугодовой ОГЭ': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (русский язык + биология + математика)': 'Полугодовой курс',
        'Погоня за мечтой 2к25 минимал': 'Погоня за мечтой',
        'Полугодовой курс 2к25 комбо (биология + математика)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (математика + русский язык)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (русский язык + обществознание + математика)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (математика + обществознание)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (русский язык + обществознание)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (биология + обществознание)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (биология + обществознание + математика)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (биология + обществознание + русский язык)': 'Полугодовой курс',
        'Полугодовой курс 2к25 комбо (биология + русский язык)': 'Полугодовой курс',
        'Весна ОГЭ Нормис': 'Весенний курс',
        'Весна ОГЭ Имба': 'Весенний курс',
        'Весна огэ био 2025': 'Весенний курс',
        'В погоне за соткой 2к23': 'Полугодовой курс',
        'Спец-курс "разбор 2 части" 2к23': 'Спецкурс',
        'Марафон 2к23 "Ну норм"': 'Весенний курс',
        'Марафон 2к23 "Проходка на бюджет"': 'Весенний курс',
        'Марафон 2к23 "Сын маминой подруги"':'Весенний курс',
        'Экспресс курс - последняя гонка «Эконом»': 'Спецкурс',
        'Экспресс курс - последняя гонка «Ультима»': 'Спецкурс',
        'Весенний курс ЕГЭ Имба': 'Весенний курс',
        'Весенний курс ЕГЭ Нормис': 'Весенний курс',
        'Направление ЕГЭ': 'Спецкурс',
        'Направление ОГЭ': 'Спецкурс',
        'Интенсив "Кульный" 2к24': 'Спецкурс',
        None: 'Курс не указан в БД',
        'Премиум': 'доплата при смене тарифа',
        'Повышение до платинума': 'доплата при смене тарифа'
    }

    subject_replacements = {
        'Русский': 'Русский язык',
        'Русский ОГЭ': 'Русский язык ОГЭ',
        'ОбществознаниеОГЭ': 'Обществознание ОГЭ',
        'МатематикаОГЭ': 'Математика ОГЭ',
        'История (ВСЕ САМ)': 'История',
        'Проф Математика': 'Математика',
        'Математика с Катей': 'Математика',
        'Математика с Машей': 'Математика',
        'Английский НА МАКСИМАЛКАХ': 'Английский язык',
        'Математика база': 'Математика',
        'Математика (база)': 'Математика',
        'Математика 85+ баллов': 'Математика',
        'Английский': 'Английский язык',
        'Обществознание ЕГЭ': 'Обществознание',
        'Математика 85+ ': 'Математика',
        'Английский ЕГЭ': 'Английский язык',
        'Литература 85+ баллов': 'Литература',
        'Обществознание Огэ': 'Обществознание ОГЭ',
        'История ЕГЭ': 'История',
        'Английский Имба': 'Английский язык',
        'Математика 85+': 'Математика'
    }
